# Система логирования. Особенности использования на проекте

### Общиая информация
Система логирования предназначена для того чтобы быстро выявлять ошибки разных уровней для последующего их устранения
Стандарты логирования описаны тут  PSR-3: Logger Interface https://www.php-fig.org/psr/psr-3/

#### Уровни ошибок

    0 - emergency
    1 - alert
    2 - critical
    3 - error
    4 - warning
    5 - notice
    6 - info
    7 - debug

Первые 4-е уровня выводятся в GrayLog

Подробоности про уровни ошибок можно почитать в документации по PSR-3 (по ссылке выше)

### Особенности использования логирования на проекте

1. Логи со стейджа отправляются в внешний сервис логирования GrayLog
2. Локально логи сохраняются в var/log/test.log
3. Взаимодействие с сервисом GrayLog настроено так, что отображаются логи только первых 4-х уровней **emergency, alert, critical, error**
4. Какой уровень ошибки выставлять в коде при логировании, определяет по каждому конкретному случаю программист, на основе стандартов PSR-3
5. Пример вызова логирования уровня error

```
 use Psr\Log\LoggerInterface;

..... 
... 

 private LoggerInterface $logger;

 public function __construct(ResponseDebugModeChecker $debugModeChecker, HealthLogger $healthLogger)
 {
     $this->debugModeChecker = $debugModeChecker;
     $this->logger           = $healthLogger->getLogger();
 }
    
 $this->logger->error($errorMessage, [
     'location'           => 'ExceptionJsonResponder::__invoke()',
     'log_level'          => 'error',
     'exception'          => $exception,
     'customErrorMessage' => $customErrorMessage,
     'errorMessage'       => $exception->getMessage(),
     'code'               => $exception->getCode(),
 ]);
```
6. Первый параметр метода логов ($errorMessage) в Graylog выводится как заглавие лога 
7. Второй параметр - ассоциативный массив. Передавать в массив можно практически любую полезну информацию, 
   которая поможет точнее и быстрее определить причину ошибки, 
   а потому во втором параметре можно передать любые параметры по соответственным ключам, чтобы их можно было
   потом найти в Graylog и оценить ошибку
8. Кастомные ключи логов в Graylog имеют приставку "ctxt_", которая подставляется Graylog-ером автоматически
9. По факту логи можно вызывать в любом месте кода, но как правило они вызываются там где перехватывается исключения
10. Для нашего проекта рекомендуется обязательно передавать в логах такую информацию: 
```
 'location'  => 'CreateUserIdsData::execute()' // потому что в GrayLog сложно быстро понять откуда пришел лог
 'log_level' => 'critical', // потому что в GrayLog указывается только (int) id уровня
 'exception' => $exception, // необходимая информация об эксепшене
```
  Остальные параметры по необходимости указывает программист. Это может быть и текст ошибки и набор разных 
  параметров метода и какие-то текущие переменные которые используются в методе на определенном этапе, 
  которые помогут разобраться с ошибкой

### Поиск по Graylog

Чтобы найти нужную нам информацию в Graylog по конкретному ключу, нужно в поисковой строке указать этот ключ 
и через двоеточие и пробел - указать поисковую фразу. 
В поисковой фразе есть свои правила указывания маски поиска, где звездочка '*' означает любой(-ые) символ(-ы). 

Пример поисковой фразы:

      ctxt_description: CreateUserIdsData*

Более подробно по поиску можно посмотреть в документации по graylog и других источниках в интернете, 
например тут https://alextoolsblog.blogspot.com/2018/12/graylog-syntax.html




