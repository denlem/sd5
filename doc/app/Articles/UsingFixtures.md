# Особенности использование фикстур

### 1. Пример нормальных Main-фикстур
* GenderFixture с двумя сущностями: "мужской" и "женский", непосредственно используемая в тестах:
    * `\App\Tests\ApiAction\Page\AuthorActionTest`
    * `\App\Tests\ApiAction\PersonalArea\Handler\Resume\ResumeHandlerActionTest\CreateFullDataResumeTest`
    * `\App\tests\ApiAction\Entity\GenderActionTest`.
* GenderLanguageFixture с переводами пола на разные языки, и каждый из этих переводов используется в нескольких тестах.
* CurrencyFixture, используемая на текущий момент только в 1 тесте, но существуют ещё не покрытые тестами ЭП, в которых данные
  этой фикстуры потребуются, либо такие ЭП ещё не созданы, но это в планах.
* UserFixture с как минимум 1 учётной записью пользователя, которая позволяет входить в админку через браузер.

**Примеры Main-фикстур, сущности из которых следовало вынести в Runtime-фикстуру:**
* UserFixture c 2-мя учётными записями. Учётная запись 1 нужна для входа в админку, а учётная запись 2 используется в тестах. В ней дата истечения подписки на 3 года большей текущей даты, так как в тестах нужна актуальная подписка. Лучше перенести **учётную запись 2** в Runtime фикстуру и при каждом выполнении теста генерировать дату, большую текущей даты, так как это повысит стабильность тестов, сняв необходимость исправления фикстуры через 3 года.
* QuestionFixture с 5 вопросами. Вопросы 1,2,4,5 используется в тестах и для проверки админки. Вопрос 3 не имеет вариантов ответа и используется в единственном тесте, проверяющем поведение ЭП при запросе теста с вопросом без вариантов ответа. **Вопрос 3** следовало разместить в Runtime-фикстуре в отдельном каталоге этого теста, так как необходимость повторного использования такой фикстуры не очевидна. Кроме того, пока этот вопрос размещён в Main-фикстуре, сложнее надёжно гарантировать, что в дальнейшем данному вопросу не будут добавлены варианты ответа при разработке новых тестов (варианты ответа - это отдельная сущность).

### 2. Избегайте редактирования уже существующих сущностей в Main-фикстуре
Main-фикстуры повторно используемые. Редактирование повторно используемых фикстур может вести к негативным последствиям (см. 15.4).
Если возникла потребность в редактировании, рассмотрите создание новой сущности в этой фикстуре, либо создание Runtime-фикстуры с ней.

### 3. Не увеличивайте количество сущностей в Main-фикстурах без необходимости
Если Main-фикстура дополняется новой сущностью не должно быть уже имеющейся сущности этой Main-фикстуры, которую можно было бы использовать
без существенных проблем (см. 15.4).

### 4. Следует с осторожностью прибегать к повторному использованию фикстур.
Необдуманное повторное использование фикстур может привести к следующим негативным последствиям:
* Неожиданные падения тестов, не относящихся к текущей задаче, но использующих ту же фикстуру.
* Сложный ручной анализ потенциальных проблем с тестами при принятии решения - можно ли повторно использовать уже существующую фикстуру,
  а так же, можно ли её рефакторить или удалить при удалении явно использующего её теста.
  Сложность такого анализа обусловлена следующими факторами:
    * Сложность анализа пропорциональна количеству использующих тестов, а так же количеству фикстур связанных с исследуемой.
    * Фикстура из совместно используемого набора фикстур не всегда имеет очевидную связь с тестами, которые её используют.
      Пример: Тест 1 проверял страницу списка курсов и явно использовал данные Курса 1 и 2 из фикстуры, загружая её и обращаясь
      к её константе NAME_ID_1, NAME_ID_2 и прочим константам с данными курса.
      Тест 2 проверяет страницу личного кабинета с курсом 2 и неявно использовал Курс 1 из той же фикстуры.
      Он учитывал наличие курса 1 только в счётчике курсов, однако его данные на странице не фигурировали.
      Если тест 1 станет не нужен, то при анализе использования публичных констант фикстуры курсов возникнет ошибочное предположение,
      что курс 1 из фикстуры так же не нужен.
    * Ошибки в работе тестов могут быть скрытыми и их не удастся исправить при выполнении тестов.
      Один из вариантов таких скрытых ошибок может происходить в тестах, проверяющих случаи неуспешного результата работы ЭП или метода.
      Такие тесты могут продолжать успешно проходить, хотя причина неуспешного результата может измениться в результате правки фикстур.


