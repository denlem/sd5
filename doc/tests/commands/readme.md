# Команды управления тестами

- [Выполнить тесты](#выполнить-тесты)
- [Подготовить тестовые данные и выполнить тесты](#подготовить-тестовые-данные-и-выполнить-тесты)
- [Очистка тестового каталога media](#очистка-тестового-каталога-media)
- [Формирование отчёта о покрытии](#формирование-отчёта-о-покрытии)

Подразумевается, что у вас создана ссылка `mic` для быстрого вызова скрипта
`/bin/control.sh` из директории проекта.

Для вывода списка доступных команд управления тестами и краткой
информации о них выполните:
```shell
mic t h
```



## Выполнить тесты
```shell
mic t r
```
*Расшифровка*: **t**ests **r**un

При вызове без дополнительных опций, команда выполнит все тесты.

Возможна передача любых параметров phpunit CLI:
```shell
mic t r ['phpunit CLI options']
```
В случае если передано более
одной опции, либо в составе опции есть пробел, следует заключить всю строку
опций в кавычки.

### Примеры:
Выполнить все тесты с настройками по умолчанию:
```shell
mic t r
```
Выполнить заданный тест
```shell
mic t r src/tests/SomeTest.php
```
Выполнить заданный тест с отключенным цветовым оформлением:
```shell
mic t r 'src/tests/SomeTest.php --colors=never'
```
Выполнить все тесты. При выводе результатов ограничить ширину столбца 20-ю
символами: 
```shell
mic t r --columns=20
```

### Среда для выполнения
Выполнять на хостовой ОС (не в контейнерах).



## Подготовить тестовые данные и выполнить тесты
```shell
mic t pr
```
*Расшифровка:* **p**repare and **r**un **t**ests

Под **подготовкой тестовых данных** подразумевается:
- очистка каталога media для тестовой среды (см. mic t cm),
- загрузка фикстур, в процессе которой помимо наполнения БД будет заново
сгенерирован тестовый контент в каталоге media.

При вызове без дополнительных опций, команда выполнит **все** тесты, а так же
потребует подтверждения от пользователя в опасных ситуациях.

### Force Mode

Предотвратить запрос подтверждений можно при помощи передачи опции `f`
(**f**orce mode):
```shell
mic t pr f
```
При этом, если опасная ситуация произошла, сообщение о ней будет выведено,
а действие будет выбрано автоматически. Прежде чем
включать его, ознакомьтесь со списком этих действий по умолчанию в разделе
[**mic t cm - Force Mode**](#команда-предусматривает-следующий-список-опасных-ситуаций).

Подробнее о том, какие ситуации расцениваются как опасные см. в [описании
`mic c cm`](#очистка-тестового-каталога-media)

### phpunit CLI options
Так же как и в `t r` возможна передача опций phpunit CLI. Подробнее см. в [`mic t r`](#выполнить-тесты)

Если вместе с этими опциями передаётся опция f, порядок этих опций не имеет
значения. Оба нижеперечисленных варианта равнозначны:
```shell
mic t pr f 'src/tests/SomeTest.php --colors=never'
mic t pr 'src/tests/SomeTest.php --colors=never' f
```
### Примеры:
```shell
mic t pr
mic t pr f
mic t pr 'src/tests/SomeTest.php --colors=never'
mic t pr f 'src/tests/SomeTest.php --colors=never'
mic t pr 'src/tests/SomeTest.php --colors=never' f
mic t pr src/tests/SomeTest.php
```

### Среда для выполнения
Выполнять на хостовой ОС (не в контейнерах).



## Очистка тестового каталога media
```shell
mic t cm
```
*Расшифровка:* **t**ests: **c**lear **m**edia directory

Из тестового каталога media будут удалены все файлы и подкаталоги за исключением
файлов .gitignore и подкаталогов, в которых они находятся. Список удалённого будет
выведен.

**Каталог media** - каталог, который используется Sonata Media для хранения
медиа-контента.  
**Тестовый каталог media** - каталог media, который используется только для тестов.  
Путь к этому каталогу определяется на основе переменных
окружения. В случае если любая из этих переменных окружения не задана будет выведено
сообщение об ошибке, требующее подтверждения пользователя, при этом очистка
каталога производится не будет. Такая ситуация расценивается как **опасная**,
так как в случае продолжения работы скрипта могло произойти удаление всего
каталога проекта, родительских каталогов файловой системы.

Существует несколько подобных опасных ситуаций, требующих внимания пользователя
и, соответственно, пользовательского ввода для продолжения. Эти запросы ввода
могут быть отключены при помощи Force Mode.

### Force Mode
В случае необходимости отключения запроса подтверждений от пользователя при
опасных ситуациях следует включить **Force Mode** передав опцию `f`:
```shell
mic t cm f
```
#### Команда предусматривает следующий список опасных ситуаций:
- Не задана одна из переменных окружения, при помощи которых определяется путь
к тестовому каталогу media. В Force Mode очистка не будет выполнена.
- Внутренняя переменная этого скрипта, хранящая полный путь к media, содержит
неверный путь (такое возможно только в случае ошибки при модификации этого
скрипта). В Force Mode очистка не будет выполнена.

### Среда для выполнения
Выполнять на хостовой ОС (не в контейнерах).



## Формирование отчёта о покрытии
Команда подробно описана в [отдельной статье руководства](../coverage/readme.md)